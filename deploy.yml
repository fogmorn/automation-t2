---
# file: deploy.yml

- name: Deploy fronend server
  hosts: front

  tasks:
  - name: Ensure nginx is at the latest version
    ansible.builtin.apt:
      update_cache: yes
      name: nginx
      state: latest
  - name: Write the nginx config file
    ansible.builtin.copy:
      src: ./front/nginx_conf/site.conf
      dest: /etc/nginx/sites-enabled/
  - name: Remove nginx default virtualhost
    ansible.builtin.file:
      path: /etc/nginx/sites-enabled/default
      state: absent
  - name: Add site files
    ansible.builtin.copy:
      src: ./front/site_static/
      dest: /var/www/html/site/
      owner: root
      group: www-data
      mode: 0644
  - name: Start nginx
    ansible.builtin.command:
      cmd: /etc/init.d/nginx start
